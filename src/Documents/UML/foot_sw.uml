@startuml

hide empty description


state GetSW0 {
	state GetADVal0 : Read AN0
	state JudgeSW0 : AD val to SW
	state UpdateCurrSW : currSW = SW

	[*] -> GetADVal0
	GetADVal0 -> JudgeSW0
	JudgeSW0 -> UpdateCurrSW
	UpdateCurrSW -> [*]
}

state GetSW1 {
	state GetADVal1 : Read AN0
	state JudgeSW1 : AD val to SW

	[*] -> GetADVal1
	GetADVal1 -> JudgeSW1
	JudgeSW1 -> [*]
}


[*] --> GetSW0
GetSW0 --> CheckHoldTime	: lastSW == currSW
GetSW0 --> Wait2ms	: lastSW != currSW

state Wait2ms :	for debounce
Wait2ms --> GetSW1

state Issue_SW_CHANGED_EVENT
	Issue_SW_CHANGED_EVENT : lastSW = SW
	Issue_SW_CHANGED_EVENT : changed = true
	Issue_SW_CHANGED_EVENT : lastTick = TickGet()

GetSW1 --> Issue_SW_CHANGED_EVENT : currSW == SW
GetSW1 --> [*] : currSW != SW
Issue_SW_CHANGED_EVENT --> [*]


state CheckHoldTime : changed && (2 sec. < (TickGet() - lastTick))
CheckHoldTime --> [*] : No
state Issue_SW_HOLD_EVENT : changed = false 
CheckHoldTime --> Issue_SW_HOLD_EVENT : Yes
Issue_SW_HOLD_EVENT --> [*]

@enduml
